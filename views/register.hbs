<div>
  <img class="current_image" src="/images/cinq_background.png">
  <div class="container page-login">
    <div class="logo-signin ">
      <img class="img-responsive" src="/images/logo.png" />
    </div>
    <div>
      <form id="register_form" class="form-signin">
        <fieldset>
          <input required autofocus name="name" id="name" type="text" class="form-control" placeholder="Name" maxlength="100">
          <input required name="login" id="login" type="text" class="form-control" placeholder="Login" maxlength="100">
          <input required name="email" id="email" type="email" class="form-control" placeholder="E-mail" maxlength="100">
          <input required id="password" name="password" type="password" class="form-control" placeholder="Password" maxlength="100">
          <input required id="confirmPassword" name="confirmPassword" type="password" class="form-control" placeholder="Confirm password" maxlength="100">
          <div class="form-group flt_left">
            <label for="adminUser" class="flt_right">&nbsp Give administrator privileges for this user</label>
            <input type="checkbox" class="flt_right" name="adminUser" id="adminUser">
          </div>
          <button type="submit" class="btn btn-info btn-block">Create account</button>
        </fieldset>
      </form>
    </div>
  </div>
</div>

<script>
  $(document).ready(function(){
    {{#if isAdmin}}
      
    {{else}}
      Swal.fire({
        title: 'Administrator only',
        text: 'Sorry, you need administrator previleges!',
        type: 'error',
        confirmButtonText: 'Continue',
        confirmButtonColor: '#EE9658'
      }).then(result => {
        window.location.href = "/welcome_screens_list"
      });
    {{/if}}
  });

  $('#register_form').submit((e) => {
    e.preventDefault();

    const user = {
      name: $('#name').val(),
      login: $('#login').val(),
      email: $('#email').val(),
      password: $('#password').val(),
      isAdmin: $('#adminUser').is(':checked')
    }

    if (user.password != $('#confirmPassword').val()) {
      Swal.fire({
        title: 'Check your passwords',
        text: 'They don\'t match!',
        type: 'error',
        confirmButtonColor: '#EE9658'
      });

      $('#confirmPassword').addClass('passesDontMatch');
      $('#password').addClass('passesDontMatch');

      return false;
    } else {
      $('#confirmPassword').addClass('passesMatch');
      $('#password').addClass('passesMatch');

      $.ajax({
        type:'POST',
        url: '/api/register',
        data: JSON.stringify(user),
        contentType: 'application/json',
        success: (data) => {
          Swal.fire({
            title: 'Success!',
            text: 'User created successfully!',
            type: 'success',
            confirmButtonText: 'OK, keep going!',
            confirmButtonColor: '#EE9658'
          }).then(result => {
            window.location.href = "/welcome_screens_list"
          });
        },
        error: () => {
          Swal.fire({
            title: 'Something went wrong!',
            text: 'Try a different e-mail or login.',
            type: 'error',
            confirmButtonColor: '#EE9658'
          });
        }
      });
    }
  });
</script>